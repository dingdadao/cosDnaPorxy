# ğŸ“ æ•´ç†åçš„é¡¹ç›®ç›®å½•ç»“æ„

## ğŸ¯ æ•´ç†ç›®æ ‡

- å°†æµ‹è¯•è„šæœ¬ç»Ÿä¸€ç®¡ç†åˆ° `scripts/test/` ç›®å½•
- å°†å¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ° `bin/` ç›®å½•
- æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶ï¼ˆå¦‚ .DS_Storeï¼‰
- æ›´æ–°æ–‡æ¡£åæ˜ æ–°çš„ç›®å½•ç»“æ„

## ğŸ“‚ å½“å‰ç›®å½•ç»“æ„

```
cosDnaPorxy/
â”œâ”€â”€ main.go                    # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ go.mod                     # Goæ¨¡å—æ–‡ä»¶
â”œâ”€â”€ go.sum                     # Goä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ .gitignore                 # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .go-version               # Goç‰ˆæœ¬æ–‡ä»¶
â”œâ”€â”€ Makefile                   # æ„å»ºè„šæœ¬
â”œâ”€â”€ config.yaml               # å½“å‰ä½¿ç”¨çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ fullchain.pem             # TLSè¯ä¹¦
â”œâ”€â”€ privkey.pem               # TLSç§é’¥
â”‚
â”œâ”€â”€ bin/                       # å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ dnsupdate             # ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶
â”‚
â”œâ”€â”€ build/                     # æ„å»ºè¾“å‡ºç›®å½•ï¼ˆGitHub Actionsä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ internal/                  # å†…éƒ¨ä»£ç æ¨¡å—
â”‚   â”œâ”€â”€ config/               # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.go         # é…ç½®ç»“æ„ä½“å’ŒåŠ è½½é€»è¾‘
â”‚   â”œâ”€â”€ dns/                  # DNSæ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ handler.go        # DNSå¤„ç†å™¨æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ server.go         # DNSæœåŠ¡å™¨å¯åŠ¨é€»è¾‘
â”‚   â”‚   â””â”€â”€ types.go          # DNSç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ geosite/              # åœ°ç†ä½ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ manager.go        # Geositeæ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ metrics/              # ç›‘æ§æŒ‡æ ‡
â”‚   â”‚   â””â”€â”€ collector.go      # PrometheusæŒ‡æ ‡æ”¶é›†
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ domain.go         # åŸŸåå¤„ç†å·¥å…·
â”‚       â”œâ”€â”€ errors.go         # é”™è¯¯å¤„ç†å·¥å…·
â”‚       â””â”€â”€ logger.go         # æ—¥å¿—å·¥å…·
â”‚
â”œâ”€â”€ configs/                   # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config.yaml           # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ jp.yaml              # æ—¥æœ¬ç‰¹å®šåŸŸåé…ç½®
â”‚   â”œâ”€â”€ whitelist.txt        # ç™½åå•åŸŸå
â”‚   â””â”€â”€ designated.txt       # å®šå‘åŸŸåé…ç½®
â”‚
â”œâ”€â”€ data/                     # æ•°æ®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ aws.txt              # AWS IPèŒƒå›´æ•°æ®
â”‚   â”œâ”€â”€ cloudflare-v4.txt    # Cloudflare IPv4èŒƒå›´
â”‚   â””â”€â”€ cloudflare-v6.txt    # Cloudflare IPv6èŒƒå›´
â”‚
â”œâ”€â”€ docs/                     # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md            # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”‚   â”œâ”€â”€ OPTIMIZATION_GUIDE.md # ä¼˜åŒ–æŒ‡å—
â”‚   â””â”€â”€ REFACTOR_GUIDE.md    # é‡æ„æŒ‡å—
â”‚
â”œâ”€â”€ scripts/                  # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ shell/               # Shellè„šæœ¬
â”‚   â”‚   â””â”€â”€ updatecartv2.1.sh # è¯ä¹¦æ›´æ–°è„šæœ¬
â”‚   â””â”€â”€ test/                # æµ‹è¯•è„šæœ¬ç›®å½•
â”‚       â”œâ”€â”€ README.md        # æµ‹è¯•è¯´æ˜æ–‡æ¡£
â”‚       â”œâ”€â”€ test_dns.sh      # åŸºç¡€DNSæµ‹è¯•
â”‚       â”œâ”€â”€ test_doh_connectivity.sh # DoHè¿é€šæ€§æµ‹è¯•
â”‚       â”œâ”€â”€ test_doh_fixed.sh # DoHä¿®å¤ååŠŸèƒ½æµ‹è¯•
â”‚       â”œâ”€â”€ test_upstream_doh.sh # ä¸Šæ¸¸DoHé…ç½®æµ‹è¯•
â”‚       â”œâ”€â”€ test_cname_resolution.sh # CNAMEè§£ææµ‹è¯•
â”‚       â”œâ”€â”€ simple_cname_test.sh # ç®€å•CNAMEæµ‹è¯•
â”‚       â”œâ”€â”€ test_dns_protocols.sh # å¤šåè®®DNSæµ‹è¯•
â”‚       â”œâ”€â”€ test_multiprotocol.sh # å¤šåè®®å¹¶å‘æµ‹è¯•
â”‚       â””â”€â”€ test_geosite.go  # GeositeåŠŸèƒ½æµ‹è¯•
â”‚
â”œâ”€â”€ .github/                  # GitHubé…ç½®
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ go-build.yml     # GitHub Actionsæ„å»ºé…ç½®
â”‚
â”œâ”€â”€ v2ray.com/               # V2Rayåè®®ç›¸å…³ï¼ˆç¬¬ä¸‰æ–¹ï¼‰
â”œâ”€â”€ vendor/                  # Goä¾èµ–åŒ…ï¼ˆç¬¬ä¸‰æ–¹ï¼‰
â””â”€â”€ .git/                    # Gitç‰ˆæœ¬æ§åˆ¶
```

## ğŸ”„ æ•´ç†å˜æ›´

### æ–°å¢ç›®å½•

- `bin/` - å­˜æ”¾ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶
- `scripts/test/` - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æµ‹è¯•è„šæœ¬

### ç§»åŠ¨æ–‡ä»¶

- æ‰€æœ‰ `test_*.sh` è„šæœ¬ â†’ `scripts/test/`
- `simple_cname_test.sh` â†’ `scripts/test/`
- `test_geosite.go` â†’ `scripts/test/`
- `dnsupdate` å¯æ‰§è¡Œæ–‡ä»¶ â†’ `bin/`

### åˆ é™¤æ–‡ä»¶

- `.DS_Store` - macOS ç³»ç»Ÿæ–‡ä»¶

### æ›´æ–°æ–‡æ¡£

- `README.md` - æ›´æ–°ç›®å½•ç»“æ„å’Œä½¿ç”¨è¯´æ˜
- `scripts/test/README.md` - æ–°å¢æµ‹è¯•è„šæœ¬è¯´æ˜æ–‡æ¡£

## ğŸš€ ä½¿ç”¨è¯´æ˜

### ç¼–è¯‘å’Œè¿è¡Œ

```bash
# ç¼–è¯‘
go build -o bin/dnsupdate main.go

# è¿è¡Œ
./bin/dnsupdate
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd scripts/test

# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.sh

# è¿è¡Œæµ‹è¯•
./test_dns.sh
```

### æŸ¥çœ‹æµ‹è¯•è¯´æ˜

```bash
cat scripts/test/README.md
```

## ğŸ“‹ ç›®å½•è¯´æ˜

### `bin/` - å¯æ‰§è¡Œæ–‡ä»¶

- å­˜æ”¾ç¼–è¯‘åçš„ç¨‹åº
- ä¾¿äºç®¡ç†å’Œåˆ†å‘

### `scripts/test/` - æµ‹è¯•è„šæœ¬

- æŒ‰åŠŸèƒ½åˆ†ç±»çš„æµ‹è¯•è„šæœ¬
- åŒ…å«è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- æ”¯æŒå¿«é€ŸåŠŸèƒ½éªŒè¯

### `build/` - æ„å»ºè¾“å‡º

- ä¿ç•™ç»™ GitHub Actions ä½¿ç”¨
- è‡ªåŠ¨æ„å»ºå¤šå¹³å°ç‰ˆæœ¬

## âœ… æ•´ç†å®Œæˆ

é¡¹ç›®ç›®å½•ç»“æ„å·²æ•´ç†å®Œæˆï¼Œç°åœ¨æ›´åŠ æ¸…æ™°å’Œè§„èŒƒï¼š

- æµ‹è¯•è„šæœ¬ç»Ÿä¸€ç®¡ç†
- å¯æ‰§è¡Œæ–‡ä»¶é›†ä¸­å­˜æ”¾
- æ–‡æ¡£åŠæ—¶æ›´æ–°
- ä¾¿äºç»´æŠ¤å’Œä½¿ç”¨
